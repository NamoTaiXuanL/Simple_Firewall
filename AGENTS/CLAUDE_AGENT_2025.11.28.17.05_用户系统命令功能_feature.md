# 项目名称项目组 作者Mamoniel 日期 2025.11.28 版本 1.0 用户系统命令功能

## 任务内容
增加系统命令模块，实现 `/new` 命令用于新建对话（不使用之前的上下文，重开对话，记录文件也保存新的，重新注入系统提示词）。

## 设计说明
**重要**: 系统命令是给**用户**使用的，不是给agent使用的！

## 实现内容
1. **系统命令管理器** (`system_commands_manager.py`):
   - 管理以 `/` 开头的系统级命令
   - 实现 `/new` 命令：清空对话上下文，重新注入系统提示词
   - 支持命令扩展，便于后续添加更多系统命令

2. **主程序集成** (`basic_shell_agent.py`):
   - 在用户输入循环中检查系统命令
   - 系统命令优先于普通任务处理
   - 为用户显示可用的系统命令说明

## `/new` 命令功能
- **清空对话历史**: 调用 `conversation_manager.clear_conversations()`
- **重新构建上下文**: 创建只包含系统提示词的新上下文
- **重新注入系统提示词**: 将系统提示词保存到新的记录文件
- **记录操作**: 在记录文件中标记新建对话操作
- **用户反馈**: 显示操作状态和结果

## 用户界面改进
1. **启动时显示**: 列出所有可用的系统命令
2. **输入提示**: 在用户输入提示中包含系统命令示例
3. **执行反馈**: 显示系统命令执行结果

## 代码结构
```
system_commands_manager.py  # 系统命令管理器
├── SystemCommandsManager   # 主类
├── is_system_command()     # 命令识别
├── execute_system_command() # 命令执行
└── _handle_new_command()    # /new命令处理

basic_shell_agent.py        # 主程序集成
├── 导入系统命令管理器
├── 初始化系统命令管理器
└── 用户输入循环中集成系统命令检查
```

## 测试结果
✓ 系统命令管理器功能正常
✓ `/new` 命令识别正确
✓ 对话记录文件正确更新
✓ 系统提示词重新注入
✓ 用户界面显示命令说明
✓ 系统提示词不包含系统命令说明（正确）

## 使用方式
用户可以在命令行直接输入：
```
/new
```
来创建新的对话会话，程序会：
1. 清空之前的所有对话上下文
2. 重新开始记录文件
3. 重新注入系统提示词
4. 提示新对话已创建成功

这是一个最小化但功能完整的实现，为用户提供了对话管理的基本控制功能。